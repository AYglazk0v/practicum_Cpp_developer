<details>
<summary>Теория + тестирование:</summary>

# Инвалидация указателей и ссылок

Первая часть этого урока будет посвящена указателям. Разобравшись с ними, вы легко справитесь со ссылками на элементы вектора и дека во второй части.

### Указатели на элементы вектора и дека при удалении/вставке

----------

Вы уже знаете, что произойдёт с указателем  `data_ptr`:

```cpp
vector<int> v = {1, 2, 3};
int* data_ptr = v.data();
v.push_back(4);

```

-   Ничего не произойдёт.
    
-   А что с ним должно произойти?
    
-   Он может инвалидироваться.
    

----------

Закрепим. Что будет выведено на экран?

```cpp
vector<string> oh_my_god = { "Oh "s, "my "s, "God"s };
const string* ptr = &oh_my_god[0];
const int exclamations = 1000;

cout << *ptr << *(ptr + 1) << *(ptr + 2) << endl;

for (int i = 0; i < exclamations; ++i) {
    oh_my_god.push_back("!");
}

cout << *ptr << *(ptr + 1) << *(ptr + 2) << endl;

```

-   ```cpp
    Oh my God
    Oh my God
    
    ```
    
-   ```cpp
    Oh my God
    
    ```
    
-   ```cpp
    Oh my God
    Oh my God <и 1000 восклицательных знаков>
    
    ```
    
-   Честно говоря, непонятно.
    

Заменим контейнер на дек:

```cpp
deque<string> oh_my_god = { "Oh "s, "my "s, "God"s };
string* ptr = &oh_my_god[0];
const int exclamations = 1000;

cout << *ptr << *(ptr + 1) << *(ptr + 2) << endl;

for (int i = 0; i < exclamations; ++i) {
    oh_my_god.push_back("!");
}

cout << *ptr << *(ptr + 1) << *(ptr + 2) << endl;

```

Преимущество дека перед вектором в том, что при вставке в начало и в конец копирования не происходит. Это спасает указатели. В данном примере будет выведено:

```cpp
Oh my God
Oh my God

```

Вставим элементы в середину:

```cpp
deque<string> oh_my_god = { "Oh "s, "my "s, "God"s };
string* ptr = &oh_my_god[0];
const int exclamations = 1000;

cout << *ptr << *(ptr + 1) << *(ptr + 2) << endl;

// Вставим восклицательные знаки после Oh my
auto it = oh_my_god.begin() + 2;
oh_my_god.insert(it, exclamations, string("!"s));

// Выведем весь дек с помощью ptr
for (int i = 0; i < oh_my_god.size(); ++i) {
    cout << *(ptr + i);
}

```

При выводе дек выглядит не так, как планировалось — мало восклицательных знаков и пропал  `God`:

```
Oh my God
Oh my !!!!!!!!!!!!!!

```

Резюме:

-   При вставке/удалении в вектор указатели инвалидируются всегда;
-   При вставке/удалении в начало или в конец дека — сохраняются;
-   При вставке/удалении из середины дека указатели инвалидируются.

### Ссылки на элементы вектора и дека при удалении/вставке

Для ссылок верно всё, что было верно для указателей:

-   При вставке/удалении в вектор ссылки инвалидируются всегда;
-   При вставке/удалении в начало или в конец дека ссылки сохраняются;
-   При вставке/удалении из середины дека ссылки инвалидируются.

</details>

<details>
<summary>Ответы:</summary>

# Ответы на задания

Вы уже знаете, что произойдёт с указателем  `data_ptr`:

```cpp
vector<int> v = {1, 2, 3};
int* data_ptr = v.data();
v.push_back(4);

```

-   **(-)**  Ничего не произойдёт.
    
-   **(-)**  А что с ним должно произойти?
    
-   **(+)**  Он может инвалидироваться.
    

----------

Закрепим. Что будет выведено на экран?

```cpp
vector<string> oh_my_god = { "Oh "s, "my "s, "God"s };
const string* ptr = &oh_my_god[0];
const int exclamations = 1000;

cout << *ptr << *(ptr + 1) << *(ptr + 2) << endl;

for (int i = 0; i < exclamations; ++i) {
    oh_my_god.push_back("!");
}

cout << *ptr << *(ptr + 1) << *(ptr + 2) << endl;

```

-   **(-)**  `cpp Oh my God Oh my God`
    
-   **(-)**  `cpp Oh my God`
    
-   **(-)**  `cpp Oh my God Oh my God <и 1000 восклицательных знаков>`
    
-   **(+)**  Честно говоря, непонятно.

</details>
